<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion Dropbox</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #dropbox-status {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>Connexion à Dropbox</h2>
    <p id="dropbox-message">Connectez-vous pour gérer vos fichiers en toute simplicité.</p>

    <button id="connect-dropbox" onclick="loginWithDropbox()">Connexion à Dropbox</button>
    <p id="dropbox-status">❌ Non connecté à Dropbox</p>
    <button id="logout-button" onclick="logoutFromDropbox()" style="display: none;">Déconnexion</button>

    <button id="ma-dropbox-btn" style="display: none;" onclick="window.location.href='dropbox.html'">Ma Dropbox</button>
    
    <script>
        const APP_KEY = "0z41GO683A6XB20"; // Clé de l'application Dropbox
        const REDIRECT_URI = "https://sofy2831.github.io/toxdetect/auth.html"; // URL de redirection

        function loginWithDropbox() {
            const authUrl = `https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=${APP_KEY}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`;
            window.location.href = authUrl;
        }

        function getDropboxAccessToken() {
            const token = localStorage.getItem("dropbox_token");
            const statusElement = document.getElementById("dropbox-status");
            const logoutButton = document.getElementById("logout-button");
            const dropboxButton = document.getElementById("ma-dropbox-btn");

            if (token) {
                statusElement.innerHTML = "✅ Connecté à Dropbox";
                logoutButton.style.display = "block";
                dropboxButton.style.display = "block";
            } else {
                statusElement.innerHTML = "❌ Non connecté à Dropbox";
            }
        }

        function logoutFromDropbox() {
            localStorage.removeItem("dropbox_token");
            alert("Vous avez été déconnecté de Dropbox.");
            location.reload();
        }

        window.onload = function() {
            getDropboxAccessToken();

            // Récupération du token après authentification
            const hash = window.location.hash;
            if (hash) {
                const params = new URLSearchParams(hash.substring(1));
                const accessToken = params.get('access_token');
                if (accessToken) {
                    localStorage.setItem("dropbox_token", accessToken);
                    window.location.hash = '';
                    getDropboxAccessToken();
                }
                <div class="content-box">
    <p id="dropbox-folder">Dossier : toxdetect backup</p>
    <!-- L'iframe qui intègre le dossier Dropbox -->
    <iframe id="dropbox-iframe" src="https://www.dropbox.com/home/Applications/ToxDetect%20Backup" 
            width="100%" 
            height="600px" 
            frameborder="0">
    </iframe>
</div>

            }
        };
    </script>

    <!-- Génération du document Word -->
    <h2>Générer un document Word</h2>
    <p id="message">Avant de générer votre document, prenez un instant pour structurer les faits de manière chronologique et précise. Un récit bien organisé facilite la compréhension de votre situation et renforce l'impact de votre dossier juridique.</p>
    <ul>
        <li><strong>Décrivez les faits dans l'ordre chronologique</strong> (du plus ancien au plus récent).</li>
        <li><strong>Soyez précis</strong> : incluez des dates, lieux et personnes impliquées.</li>
        <li><strong>Restez factuel</strong> : évitez les interprétations et concentrez-vous sur les événements.</li>
        <li><strong>Mentionnez les preuves</strong> (documents, SMS, mail, écrits, témoignages, etc.).</li>
    </ul>
    <button id="generateButton">Créer un fichier Word</button>

    <script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.min.js"></script>
    <script>
        document.getElementById("generateButton").addEventListener("click", function() {
            const { Document, Packer, Paragraph, TextRun } = window.docx;

            const doc = new Document({
                sections: [
                    {
                        children: [
                            new Paragraph({ children: [new TextRun("Bienvenue sur ToxDetect.")] }),
                            new Paragraph({ children: [new TextRun("Récit des faits.")] }),
                            new Paragraph({ children: [new TextRun("Date de l’événement : (Pièce n°...)")] }),
                            new Paragraph({ children: [new TextRun("Signature :")] }),
                            new Paragraph({ children: [new TextRun("P.S: Indiquer le nom des pièces (Pièces n°...) :")] }),
                            
                        ],
                    },
                ],
            });

            Packer.toBlob(doc).then((blob) => {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "rapport.docx";
                link.click();
            });
        });
    </script>
<br>
<button onclick="location.href='journal.html'">Fermer</button>
</body>
</html>
